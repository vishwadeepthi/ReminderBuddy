<!DOCTYPE html>
<html>

<head>
  <title>
    <%= title %>
  </title>
  <% include ./partials/header.ejs %>
</head>

<body>

  <div class="ui top fixed menu">
    <div class="item">
      <i class="phone volume icon big"
        style="color : green;"></i>
    </div>
    <div>
      <button value="ADD" onclick="document.location='/setup?callid='">ADD</button>
    </div>
  </div>


  <div class="ui container">
    <div class="ui relaxed list"
      style="margin-top: 5rem">

    <script>
      var data = <%- JSON.stringify(callsList) %>
      function play(btnValue){
        var audio = $.find("audio#" + btnValue);
        audio.play();
      }
    </script>
  
    <% for(var i=0; i<callsList.length; i++) { %>

      <div class="item">
        <img class="ui avatar image" src="/images/avatar/small/elliot.jpg">
        <div class="content">
          <a class="header" href="/setup?callid=<%-callsList[i].id %>"> <%-callsList[i].title %></a>
          <div class="contacts-ctn">
            <span>Will Call to:</span>
            <div class="contacts">
              <% for(var j=0; j<callsList[i].contacts.length; j++) { %>
                <span><%-callsList[i].contacts[j].name %></span>            
              <% console.log(callsList[i].contacts[j].name)}; %>
            </div>
          </div>
        </div>
        <div class="right-ctn">
          <button value=<%-callsList[i].id %> onclick="play(this.value)">Play</button>
          <audio id=<%-callsList[i].id %> src=<%-callsList[i].audio %> > </audio>
          <i id=<%-callsList[i].id %> class="trash delete-contact icon alternate outline large delete_call" style="margin-right:1rem;"></i>
        </div>
      </div>    
    
    <% }; %>
      
    </div>
  </div>
<script>
  $(".delete_call").click(function(evt){
    var id = $(this).attr("id"), self =this;
    $.ajax({
      url: "/delete_call",
        type: "POST",
        data: JSON.stringify({
          id: id
        }),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function (data) {
        $(self).parent().parent().remove();
      }
    });
  });
</script>
</body>

</html>